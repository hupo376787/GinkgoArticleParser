<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  x:Class="GinkgoArticleParser.Views.HistoryPage"
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:mm="clr-namespace:GinkgoArticleParser.Models"
  xmlns:skia="clr-namespace:SkiaSharp.Extended.UI.Controls;assembly=SkiaSharp.Extended.UI"
  xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
  xmlns:vm="clr-namespace:GinkgoArticleParser.ViewModels"
  x:Name="RootPage">
  <Grid RowDefinitions="*,Auto">

    <CollectionView
      ItemSizingStrategy="MeasureFirstItem"
      ItemsSource="{Binding HistoryItems}"
      RemainingItemsThreshold="5"
      RemainingItemsThresholdReachedCommand="{Binding LoadMoreAsyncCommand}">

      <CollectionView.Header>
        <!--<skia:SKLottieView
          Margin="0"
          HeightRequest="120"
          RepeatCount="1"
          RepeatMode="Restart"
          Source="CloudData.json"
          WidthRequest="120" />-->
        <Image HeightRequest="200" Source="collection.png" />
      </CollectionView.Header>

      <CollectionView.ItemTemplate>
        <DataTemplate>
          <HorizontalStackLayout Padding="18">
            <Label
              Text="{Binding Id}"
              TextColor="Gray"
              VerticalOptions="Center" />
            <VerticalStackLayout Margin="18,0,0,0">
              <Label Text="{Binding Title}" TextColor="Gray" />
              <Label Text="{Binding Url}" TextColor="Gray" />
            </VerticalStackLayout>

            <HorizontalStackLayout.GestureRecognizers>
              <TapGestureRecognizer Command="{Binding Source={x:Reference RootPage}, Path=BindingContext.HistoryItemTappedCommand}" CommandParameter="{Binding .}" />
            </HorizontalStackLayout.GestureRecognizers>
          </HorizontalStackLayout>
        </DataTemplate>
      </CollectionView.ItemTemplate>
    </CollectionView>

    <ActivityIndicator
      HorizontalOptions="Center"
      IsRunning="{Binding IsLoading}"
      IsVisible="{Binding IsLoading}"
      VerticalOptions="Center" />

  </Grid>
</ContentPage>
